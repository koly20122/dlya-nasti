<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–ª—è –ù–∞—Å—Ç–∏ üíê</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container video-page">
        <div class="video-wrapper">
            <video id="myVideo" width="100%" controls style="border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <source src="video.mp4" type="video/mp4">
                –¢–≤–æ–π –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
            </video>
            
            <div style="margin-top: 30px; text-align: center;">
                <button class="btn" id="playBtn">‚ñ∂ play me</button>
            </div>
            
            <div id="downloadBtnContainer" style="margin-top: 20px; text-align: center; display: none;">
                <button class="btn secondary" id="downloadBtn">üíæ –ó–∞–ø–æ–º–Ω–∏—Ç—å –º–æ–º–µ–Ω—Ç</button>
            </div>
        </div>
    </div>

    <script>
        const video = document.getElementById('myVideo');
        const playBtn = document.getElementById('playBtn');
        const downloadContainer = document.getElementById('downloadBtnContainer');
        const videoUrl = 'video/video.mp4'; // –ø—É—Ç—å –∫ –≤–∏–¥–µ–æ

        playBtn.addEventListener('click', () => {
            video.play();
            video.requestFullscreen?.();
            playBtn.style.display = 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤–∏–¥–µ–æ
            video.addEventListener('ended', showDownloadButton);
            
            // –¢–∞–∫–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–π–¥–µ—Ç –∏–∑ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
            video.addEventListener('pause', function onPause() {
                if (!video.paused) return;
                if (document.fullscreenElement) return;
                showDownloadButton();
                video.removeEventListener('pause', onPause);
            });
        });

        function showDownloadButton() {
            downloadContainer.style.display = 'block';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–∏–¥–µ–æ –≤ —Ñ–æ—Ç–æ–ø–ª—ë–Ω–∫—É (–¥–ª—è iPhone)
        async function saveToPhotos(videoUrl) {
            try {
                // –°–∫–∞—á–∏–≤–∞–µ–º –≤–∏–¥–µ–æ –∫–∞–∫ blob
                const response = await fetch(videoUrl);
                const blob = await response.blob();
                
                // –°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞
                const file = new File([blob], 'dlya_nasti.mp4', { type: 'video/mp4' });
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Ñ–∞–π–ª–æ–º
                if (navigator.canShare && navigator.canShare({ files: [file] })) {
                    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–∞—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"
                    await navigator.share({
                        files: [file],
                        title: '–î–ª—è –ù–∞—Å—Ç–∏',
                        text: '–í–∏–¥–µ–æ —Å 8 –º–∞—Ä—Ç–∞ üíê'
                    });
                } else {
                    // –ï—Å–ª–∏ Web Share –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                    fallbackDownload(videoUrl);
                }
            } catch (error) {
                console.log('Web Share –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ');
                fallbackDownload(videoUrl);
            }
        }

        // –û–±—ã—á–Ω–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ (–Ω–∞ Android –∏–ª–∏ –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)
        function fallbackDownload(videoUrl) {
            const a = document.createElement('a');
            a.href = videoUrl;
            a.download = 'dlya_nasti.mp4';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            // –ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è iPhone
            if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                alert('–ù–∞–∂–º–∏ –∏ —É–¥–µ—Ä–∂–∏–≤–∞–π –Ω–∞ –≤–∏–¥–µ–æ, –≤—ã–±–µ—Ä–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–∏–¥–µ–æ"');
            }
        }

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, iPhone –ª–∏ —ç—Ç–æ
        function isIphone() {
            return /iPhone|iPad|iPod/i.test(navigator.userAgent);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–æ–º–µ–Ω—Ç"
        document.getElementById('downloadBtn').addEventListener('click', () => {
            if (isIphone()) {
                // –ù–∞ iPhone –ø—ã—Ç–∞–µ–º—Å—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ Share
                saveToPhotos(videoUrl);
            } else {
                // –ù–∞ Android –ø—Ä–æ—Å—Ç–æ —Å–∫–∞—á–∏–≤–∞–µ–º
                fallbackDownload(videoUrl);
            }
        });
    </script>
</body>
</html>